{%extends 'partials/base2.html'%}
{%block title%}Add card{%endblock%}
{%load static%}
{%load crispy_forms_tags%}

{%block content%}


<div class="bg-white p-8 rounded-lg shadow-md w-96">
    <div class="container flex">
        <img src="{%static 'shop_media/Card Page.svg'%}" alt="" data-aos="flip-up" data-aos-duration="2000">
    </div>
    <br>
    <h6 class="h6 font-bold">Payment details</h6>
    <div class="flex bg-primary-subtle border border-warning-subtle border-2 p-2 rounded-3 flex-col">

        <p class="">Outstanding: <span class="text-primary font-bold">$11,183.54</span> out of <span
                class="text-primary font-bold">$30,754</span>. <br> <br> Want to pay installmentally, <a target="_blank" href="{%url 'userauths:payment_plans'%}"
                class="text-primary font-bold">click here <span class="i bx bx-link"></span></a> to view a list of
            payment plans.</p>

    </div>
    <br>
    <h2 class="text-2xl font-bold text-center">Pay with Gift Card</h2>

    <p class="text-blue-400 items-center justify-center flex"><span><svg xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 mx-2">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" />
            </svg>
        </span>Powered by stripe.</p>
    <form method="post" enctype="multipart/form-data" class="space-y-4" id="credit-card-form">
        {% csrf_token %}
        {{ form|crispy }}

        <button type="submit"
            class="w-full bg-indigo-500 text-white py-2 px-4 rounded-lg hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed"
            id="submit-button" disabled>
            Submit
        </button>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("credit-card-form");
            const submitButton = document.getElementById("submit-button");

            const toggleSubmitButton = () => {
                const allFieldsFilled = Array.from(form.querySelectorAll("input")).every(input => {
                    return input.value.trim() !== ""; // Check if all inputs are non-empty
                });
                submitButton.disabled = !allFieldsFilled;
            };

            form.addEventListener("input", toggleSubmitButton);
        });
    </script>

    <div id="successMessage" class="mt-4 text-green-600 text-center hidden">
        Card added successfully!
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('creditCardForm');
        const successMessage = document.getElementById('successMessage');

        // Format card number input
        document.getElementById('cardNumber').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            let formattedValue = '';
            for (let i = 0; i < value.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formattedValue += ' ';
                }
                formattedValue += value[i];
            }
            e.target.value = formattedValue;
        });

        // Format expiration date input
        document.getElementById('expDate').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 2) {
                value = value.slice(0, 2) + '/' + value.slice(2);
            }
            e.target.value = value;
        });
    });
</script>
{%endblock content%}